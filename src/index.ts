import { Context, Hono } from 'hono';
import bcrypt from 'bcryptjs';
import mustache from 'mustache';
import moment from 'moment';

type Bindings = {
	DB: KVNamespace;
};

const app = new Hono<{ Bindings: Bindings }>();
const ACTIVITY_THRESHOLD = 10 * 60;

const homeTemplate = `
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
		<link rel="icon" href="data:image/png;base64,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">
    <title>WhenPress</title>
	</head>
	<body>
    <p>&nbsp;</p>
    <article>
		  <h2>WhenPress</h2>
      <p>When did I last push that button ðŸ¤”</p>
      <a href="https://github.com/yosemitebandit/whenpress">source</a>
    </article>
	</body>
</html>
`;

// TODO: show presses in last 1wk, 24hr, 1hr
const deviceTemplate = `
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
		<link rel="icon" href="data:image/png;base64,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">
    <title>{{ deviceName }} - WhenPress</title>
	</head>
	<body>
    <p>&nbsp;</p>
    <article>
		  <h2>{{ deviceTitle }}</h2>
			<p><kbd>Button Presses:</kbd>
			<kbd>{{ presses }}</kbd></p>
			<p><kbd>Last Button Press:</kbd>
			<kbd>{{ lastPressRelative }}</kbd></p>
			<details>
				<summary>All Button Presses (GMT):</summary>
				<small>
				<ol reversed>
					{{ #allPresses }}
						<li>{{ . }}</li>
					{{ /allPresses }}
				</ol>
				</small>
			</details>
      <a href="https://github.com/yosemitebandit/whenpress">source</a>
    </article>
	</body>
</html>
`;

interface DeviceData {
	events: EventData[];
}
interface EventData {
	pressTimestamp: number;
}

async function deviceExistsMiddleware(c: Context, next: () => Promise<void>) {
	const device = c.req.param('device');
	const devices = await c.env.DB.get('devices');
	if (devices == null || !JSON.parse(devices).includes(device)) {
		return c.text('not found', 404);
	}
	await next();
}

async function checkAuth(c: Context, next: () => Promise<void>) {
	const device = c.req.param('device');
	const postedData = await c.req.json().catch(() => ({}));
	if (!postedData.password) {
		return c.text('error', 400);
	}
	const storedAuth = await c.env.DB.get(`auth:${device}`);
	if (storedAuth === null) {
		return c.text('error', 501);
	}
	const authIsValid = await bcrypt.compare(postedData.password, storedAuth);
	if (!authIsValid) {
		return c.text('error', 401);
	}
	await next();
}

function formatDeviceDataToRelativeTimes(deviceData: DeviceData): string[] {
	const reversedData = deviceData.events.slice().reverse();
	return reversedData.map((entry) => {
		const pressMoment = moment.unix(entry.pressTimestamp);
		const formattedDateTime = pressMoment.format('ddd MMM D, YYYY h:mmA');
		const relativeTime = pressMoment.fromNow();
		return `${formattedDateTime} (${relativeTime})`;
	});
}

app.get('/', async (c) => {
	/* Render homepage.
	 */
	const renderedHtml = mustache.render(homeTemplate, {});
	return c.html(renderedHtml);
});

app.use('/:device', deviceExistsMiddleware);
app.get('/:device', async (c) => {
	/* Render page for a specific device.
	 */
	const deviceName = c.req.param('device');
	// Setup data for the template.
	let templateData = {
		deviceName: deviceName,
		deviceTitle: null as null | string,
		presses: 0,
		lastPressRelative: null as null | string,
		allPresses: null as null | string[],
	};
	// Track when the device was last active based on ping and press data.
	let lastActive = null;
	// Lookup data for the device.
	let deviceData = await c.env.DB.get(`data:${deviceName}`);
	if (deviceData != null) {
		let jsonData: DeviceData = JSON.parse(deviceData);
		const allPresses = formatDeviceDataToRelativeTimes(jsonData);
		const lastPress = Math.max(...jsonData.events.map((event: EventData) => event.pressTimestamp));
		lastActive = lastPress;
		const lastPressTime = moment.unix(lastPress);
		templateData = {
			deviceName: deviceName,
			deviceTitle: null,
			presses: jsonData.events.length,
			lastPressRelative: moment(lastPressTime).fromNow(),
			allPresses: allPresses,
		};
	}
	// Lookup ping data to help determine if device is online.
	const lastPing = await c.env.DB.get(`ping:${deviceName}`);
	if (lastPing != null) {
		const pingTime = parseInt(lastPing, 10);
		if (lastActive === null || pingTime > lastActive) {
			lastActive = pingTime;
		}
	}
	let deviceTitle = null;
	const now = moment().unix();
	if (lastActive === null || now - lastActive > ACTIVITY_THRESHOLD) {
		deviceTitle = `${deviceName} is offline`;
	} else {
		deviceTitle = `${deviceName} is online`;
	}
	templateData.deviceTitle = deviceTitle;
	// Render.
	const renderedHtml = mustache.render(deviceTemplate, templateData);
	return c.html(renderedHtml);
});

app.use('/:device/ping', deviceExistsMiddleware);
app.use('/:device/ping', checkAuth);
app.post('/:device/ping', async (c) => {
	/* Receive a device ping.
	 * TODO: also store as json, like other data?
	 */
	const device = c.req.param('device');
	// Register the ping.
	const now = Math.floor(Date.now() / 1000);
	await c.env.DB.put(`ping:${device}`, now.toString());
	// Respond.
	return c.text('pong');
});

app.use('/:device/data', deviceExistsMiddleware);
app.use('/:device/data', checkAuth);
app.post('/:device/data', async (c) => {
	/* Receive device data.
	 */
	const device = c.req.param('device');
	// Register the incoming data.
	const postedData = await c.req.json();
	if (!postedData.pressTimestamp) {
		return c.text('error', 400);
	}
	// First get the existing data in the db.
	let existingData = await c.env.DB.get(`data:${device}`);
	let updatedData: DeviceData = { events: [] };
	if (existingData == null) {
		// Populate for the first time.
		updatedData = {
			events: [
				{
					pressTimestamp: postedData.pressTimestamp,
				},
			],
		};
	} else {
		// Append.
		let jsonData: DeviceData = JSON.parse(existingData);
		updatedData = {
			events: [...jsonData.events, { pressTimestamp: postedData.pressTimestamp }],
		};
	}
	await c.env.DB.put(`data:${device}`, JSON.stringify(updatedData));
	// Respond.
	return c.text('ok');
});

export default app;
